C51 COMPILER V8.08   MAIN                                                                  04/21/2017 23:44:02 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*定时器1做计数器，工作模式2，使用定时器0让LED1小灯100毫秒闪烁一次，
   2          定时器1记录LED1闪烁次数，并且用数码管实时显示计数数值。
   3          
   4          注意：必须用一根杜邦线把P10接到P35，数码管才会显示LED1闪烁次数
   5          
   6          断开P10和P35的连接数码管计数停止，连接上数码管计数显示开始。
   7          定时计数器1记录来自P10的脉冲。*/
   8          #include <reg52.h>      //51头文件
   9          
  10          #define uchar unsigned char       //宏定义
  11          #define uint  unsigned int        //宏定义
  12          sbit we = P2^7; //位定义数码管位选锁存器接口
  13          sbit du = P2^6;  //位定义数码管位选锁存器接口
  14          sbit LED1 = P1^0; //led1接口
  15          //数码管段选表
  16          uchar code leddata[]={ 
  17           
  18                          0x3F,  //"0"
  19                          0x06,  //"1"
  20                          0x5B,  //"2"
  21                          0x4F,  //"3"
  22                          0x66,  //"4"
  23                          0x6D,  //"5"
  24                          0x7D,  //"6"
  25                          0x07,  //"7"
  26                          0x7F,  //"8"
  27                          0x6F,  //"9"
  28                          0x77,  //"A"
  29                          0x7C,  //"B"
  30                          0x39,  //"C"
  31                          0x5E,  //"D"
  32                          0x79,  //"E"
  33                          0x71,  //"F"
  34                          0x76,  //"H"
  35                          0x38,  //"L"
  36                          0x37,  //"n"
  37                          0x3E,  //"u"
  38                          0x73,  //"P"
  39                          0x5C,  //"o"
  40                          0x40,  //"-"
  41                          0x00,  //熄灭
  42                          0x00  //自定义
  43           
  44                                   };
  45          //毫秒级延时函数
  46          void delay(uint z)
  47          {
  48   1              uint x,y;
  49   1              for(x = z; x > 0; x--)
  50   1                      for(y = 114; y > 0 ; y--);
  51   1      }
  52          //三位数码管动态显示函数
  53          void display(uchar i)
  54          {
  55   1              uchar bai, shi, ge;
C51 COMPILER V8.08   MAIN                                                                  04/21/2017 23:44:02 PAGE 2   

  56   1              bai = i / 100; //显示百位
  57   1              shi = i % 100 / 10;     //显示十位
  58   1              ge  = i % 10;//显示个位
  59   1      
  60   1              P0 = 0xff; //清除断码
  61   1              we = 1;//打开位选
  62   1              P0 = 0xfe;//1111 1110 
  63   1              we = 0; //关闭位选
  64   1      
  65   1              du = 1; //打开段选
  66   1              P0 = leddata[bai];
  67   1              du = 0; //关闭段选
  68   1              delay(5);//延时5毫秒
  69   1              
  70   1              P0 = 0xff;//清除断码
  71   1              we = 1; //打开位选
  72   1              P0 = 0xfd;//1111 1101  
  73   1              we = 0; //关闭位选
  74   1              
  75   1              du = 1;//打开段选
  76   1              P0 = leddata[shi]; 
  77   1              du = 0; //关闭段选
  78   1              delay(5);//延时5毫秒
  79   1              
  80   1              P0 = 0xff;//清除断码
  81   1              we = 1; //打开位选
  82   1              P0 = 0xfb;//1111 1011  
  83   1              we = 0; //关闭位选
  84   1              
  85   1              du = 1;//打开段选
  86   1              P0 = leddata[ge]; 
  87   1              du = 0; //关闭段选
  88   1              delay(5);//延时5毫秒    
  89   1      }
  90          
  91          void main()
  92          {
  93   1                      uchar a; //50次数计数
  94   1                      TR0 = 1;//启动T0
  95   1                      TR1 = 1;//启动T1
  96   1                      TMOD = 0x61;//T0为定时器，工作模式1 16位计数器，T1为计数器，工作模式2，8位自动重装
  97   1                      TH0 = 0x4b;
  98   1                      TL0 = 0xfc;//0x4bfc     定时50ms
  99   1                      TH1 = 20;//8位自动重装
 100   1                      TL1 = 0;//当TL1溢出时自动装入TH1的值                            
 101   1                      while(1)
 102   1                      {
 103   2                              if(TF0 == 1)//判断T0是否溢出
 104   2                              {
 105   3                                      TH0 = 0x4b;
 106   3                                      TL0 = 0xfc;//0x4bfc     定时50ms
 107   3                                      TF0 = 0;//清零便于下次判断
 108   3                                      a++;//50毫秒计数加1     
 109   3                              }
 110   2                              if(a == 2)//判断是否到100毫秒
 111   2                              {
 112   3                                      a = 0;//清零便于下次记录50ms的次数
 113   3                                      LED1 = ~LED1;//闪烁LED1
 114   3                              }                       
 115   2                              display(TL1);//显示T1计数值
 116   2                      }
 117   1      }
C51 COMPILER V8.08   MAIN                                                                  04/21/2017 23:44:02 PAGE 3   



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    179    ----
   CONSTANT SIZE    =     25    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
