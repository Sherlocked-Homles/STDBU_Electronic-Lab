C51 COMPILER V8.08   MAIN                                                                  04/23/2017 21:35:54 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*********************************************************************************
   2          * 【编写时间】： 2016年02月15日
   3          * 【作    者】： 清翔电子:03
   4          * 【版    本】： 1.0
   5          * 【网    站】： http://www.qxmcu.com/ 
   6          * 【淘宝店铺】： http://qxmcu.taobao.com/ 
   7          * 【实验平台】： QX-MCS51 单片机开发板
   8          * 【外部晶振】： 11.0592mhz     
   9          * 【主控芯片】： STC89C52
  10          * 【编译环境】： Keil μVisio3  
  11          * 【程序功能】： LCD1602显示                                                                        
  12          * 【使用说明】： 正确接上LCD1602液晶并调节好对比度
  13          *  说明：免费开源，不提供源代码分析.
  14          **********************************************************************************/
  15          #include <reg52.h>
  16          
  17          /*=================================================
  18          *自定义数据类型
  19          =================================================*/
  20          typedef unsigned char uchar;
  21          typedef unsigned int uint;
  22          
  23          #define LCD1602_DB P0   //LCD1602数据总线
  24          
  25          sbit LCD1602_RS = P3^5;  //RS端
  26          sbit LCD1602_RW = P3^6;  //RW端
  27          sbit LCD1602_EN = P3^4;  //EN端
  28          sbit DU = P2^6;//
  29          sbit WE = P2^7;//数码管位选段选用于关闭数码管显示
  30          
  31          /*=================================================
  32          *函数名称：Read_Busy
  33          *函数功能：判断1602液晶忙，并等待
  34          =================================================*/
  35          void Read_Busy()
  36          {
  37   1              uchar busy;
  38   1              LCD1602_DB = 0xff;//复位数据总线
  39   1              LCD1602_RS = 0;   //拉低RS
  40   1              LCD1602_RW = 1;   //拉高RW读
  41   1              do
  42   1              {
  43   2                      LCD1602_EN = 1;//使能EN
  44   2                      busy = LCD1602_DB;//读回数据
  45   2                      LCD1602_EN = 0;  //拉低使能以便于下一次产生上升沿
  46   2              }while(busy & 0x80); //判断状态字BIT7位是否为1，为1则表示忙，程序等待
  47   1      }
  48          /*=================================================
  49          *函数名称：LCD1602_Write_Cmd
  50          *函数功能：写LCD1602命令
  51          *调用：Read_Busy();
  52          *输入：cmd:要写的命令
  53          =================================================*/
  54          void LCD1602_Write_Cmd(uchar cmd)
  55          {
C51 COMPILER V8.08   MAIN                                                                  04/23/2017 21:35:54 PAGE 2   

  56   1              Read_Busy();     //判断忙，忙则等待
  57   1              LCD1602_RS = 0;
  58   1              LCD1602_RW = 0; //拉低RS、RW操作时序情况1602课件下中文使用说明基本操作时序章节
  59   1              LCD1602_DB = cmd;//写入命令
  60   1              LCD1602_EN = 1;  //拉高使能端 数据被传输到LCD1602内
  61   1              LCD1602_EN = 0;  //拉低使能以便于下一次产生上升沿
  62   1      }
  63          /*=================================================
  64          *函数名称：LCD1602_Write_Dat
  65          *函数功能：写LCD1602数据
  66          *调用：Read_Busy();
  67          *输入：dat：需要写入的数据
  68          =================================================*/
  69          void LCD1602_Write_Dat(uchar dat)
  70          {
  71   1              Read_Busy();
  72   1              LCD1602_RS = 1;
  73   1              LCD1602_RW = 0;
  74   1              LCD1602_DB = dat;
  75   1              LCD1602_EN = 1;
  76   1              LCD1602_EN = 0;
  77   1      }
  78          /*=================================================
  79          *函数名称：LCD1602_Dis_OneChar
  80          *函数功能：在指定位置显示一个字符
  81          *调用：LCD1602_Write_Cmd(); LCD1602_Write_Dat();        
  82          *输入：x：要显示的横坐标取值0-40，y：要显示的行坐标取值0-1（0为第一行,1为第二行）
  83                          dat：需要显示的数据以ASCLL形式显示
  84          =================================================*/
  85          void LCD1602_Dis_OneChar(uchar x, uchar y,uchar dat)
  86          {
  87   1              if(y)   x |= 0x40;
  88   1              x |= 0x80;
  89   1              LCD1602_Write_Cmd(x);
  90   1              LCD1602_Write_Dat(dat);         
  91   1      }
  92          /*=================================================
  93          *函数名称：LCD1602_Dis_Str
  94          *函数功能：在指定位置显示字符串
  95          *调用：LCD1602_Write_Cmd(); LCD1602_Write_Dat();
  96          *输入：x：要显示的横坐标取值0-40，y：要显示的行坐标取值0-1（0为第一行,1为第二行）
  97                          *str：需要显示的字符串
  98          =================================================*/
  99          void LCD1602_Dis_Str(uchar x, uchar y, uchar *str)
 100          {
 101   1              if(y) x |= 0x40;
 102   1              x |= 0x80;
 103   1              LCD1602_Write_Cmd(x);
 104   1              while(*str != '\0')
 105   1              {
 106   2                      LCD1602_Write_Dat(*str++);
 107   2              }
 108   1      }
 109          /*=================================================
 110          *函数名称：Init_LCD1602
 111          *函数功能：1602初始化
 112          *调用： LCD1602_Write_Cmd();
 113          =================================================*/
 114          void Init_LCD1602()
 115          {
 116   1              LCD1602_Write_Cmd(0x38); //     设置16*2显示，5*7点阵，8位数据接口
 117   1              LCD1602_Write_Cmd(0x0c); //开显示
C51 COMPILER V8.08   MAIN                                                                  04/23/2017 21:35:54 PAGE 3   

 118   1              LCD1602_Write_Cmd(0x06); //读写一字节后地址指针加1
 119   1              LCD1602_Write_Cmd(0x01); //清除显示
 120   1      }
 121          
 122          void main()
 123          {
 124   1              uchar TestStr[] = {"Welcome!"};
 125   1              uchar str[] = {"LCD1602 display"};
 126   1              DU = 0;
 127   1              WE = 0;//关闭数码管显示
 128   1              Init_LCD1602();//1602初始化
 129   1              LCD1602_Dis_Str(0, 0, &TestStr[0]);     //显示字符串
 130   1              LCD1602_Dis_Str(0, 1, &str[0]); //显示字符串
 131   1              LCD1602_Dis_OneChar(15, 1, 0xff); //显示一个黑方格
 132   1              while(1);
 133   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    220    ----
   CONSTANT SIZE    =     25    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      28
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
